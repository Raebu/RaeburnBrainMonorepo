version: '3.8'

services:
postgres:
image: postgres:15
environment:
POSTGRES_DB: scrapebot
POSTGRES_USER: scrapebot
POSTGRES_PASSWORD: scrapebot123
volumes:
- postgres_data:/var/lib/postgresql/data
ports:
- "5432:5432"

redis:
image: redis:7-alpine
ports:
- "6379:6379"

minio:
image: minio/minio:latest
environment:
MINIO_ROOT_USER: minioadmin
MINIO_ROOT_PASSWORD: minioadmin
ports:
- "9000:9000"
- "9001:9001"
volumes:
- minio_data:/data
command: server /data --console-address ":9001"

api:
build: ./server/backend-api
environment:
DATABASE_URL: postgresql://scrapebot:scrapebot123@postgres:5432/scrapebot
REDIS_URL: redis://redis:6379
JWT_SECRET: your-super-secret-jwt-key
AWS_ACCESS_KEY_ID: minioadmin
AWS_SECRET_ACCESS_KEY: minioadmin
AWS_REGION: us-east-1
S3_BUCKET: scrapebot-results
ports:
- "3001:3001"
depends_on:
- postgres
- redis

worker:
build: ./server/queue-processor
environment:
DATABASE_URL: postgresql://scrapebot:scrapebot123@postgres:5432/scrapebot
REDIS_URL: redis://redis:6379
AWS_ACCESS_KEY_ID: minioadmin
AWS_SECRET_ACCESS_KEY: minioadmin
AWS_REGION: us-east-1
S3_BUCKET: scrapebot-results
depends_on:
- postgres
- redis

frontend:
build: ./client/nextjs-frontend
environment:
NEXT_PUBLIC_API_URL: http://localhost:3001
ports:
- "3000:3000"
depends_on:
- api

volumes:
postgres_data:
minio_data:
